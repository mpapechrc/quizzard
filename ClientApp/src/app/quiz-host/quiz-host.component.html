<div class="main-frame">

    <div class="top-bar">

        <div class="domain ">
            <a class="domain-link" [routerLink]="['/']">
                <app-logo></app-logo>
            </a>
        </div>

        <div class="top-bar-link">
            Šifra<span class="logoKviz">Kviza</span>:
            {{quizHostService.quizData.groupName}}
            <span class="groupname-clipboard">
                <span *ngIf="!quizHostService.quizData.copyedToCLipboard;then copyBlock else doneBlock"></span>
                <ng-template #copyBlock>
                    <button class="groupname-clipboard-button" [cdkCopyToClipboard]="quizHostService.quizData.groupName"
                        (click)="quizHostService.quizData.copyedToCLipboard=true">
                        <mat-icon>content_copy</mat-icon>
                    </button>
                </ng-template>
                <ng-template #doneBlock>
                    <mat-icon class="succesfull-groupname-copy">done_all</mat-icon>
                </ng-template>
            </span>
        </div>

    </div>

    <div class="body">

        <div class="active-players">
            <div class="active-players-card">
                Aktivni igrači:
            </div>
            <div *ngFor="let player of quizHostService.quizData.players; let i = index">
                <div [class]="playerCardClass(player)" class="active-player-card">
                    <div class="player-card-position">{{i+1}}.</div>
                    <mat-icon *ngIf="!player.isActive" class="disconnected-icon" aria-hidden="false"
                        aria-label="Player not active">wifi_off</mat-icon>
                    <div class="player-name">
                        <span [class.disconnected]="!player.isActive">{{player.name}}</span>
                    </div>
                    <div class="player-score" [class.disconnected]="!player.isActive">
                        {{player.score}}
                    </div>
                </div>
            </div>
        </div>


        <div class="quiz">
            <div *ngIf="isIdle(); then startQuizButtonBlock"></div>

            <ng-template [formGroup]="quizSetup" #startQuizButtonBlock>
                <table mat-table [dataSource]="dataSource" 
                multiTemplateDataRows 
                class="mat-elevation-z8">

                <!-- Checkbox Column -->
            <ng-container matColumnDef="select">
            <th  mat-header-cell *matHeaderCellDef>
                <!-- <mat-checkbox (change)="$event ? toggleAllRows() : null"
                            [checked]="selection.hasValue() && isAllSelected()"
                            [indeterminate]="selection.hasValue() && !isAllSelected()"
                            [aria-label]="checkboxLabel()">
                </mat-checkbox> -->
            </th>
            <td mat-cell *matCellDef="let row">
                <mat-checkbox (click)="setQuizId(row.quizId)"
                            (change)="$event ? selection.toggle(row) : null"
                            [checked]="selection.isSelected(row)"
                            [aria-label]="checkboxLabel(row)">
                </mat-checkbox>
            </td>
            </ng-container>
        
            <!-- Position Column -->
            <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef> Ime kviza </th>
            <td mat-cell *matCellDef="let element"> {{element.name}} </td>
            </ng-container>
        
            <!-- Name Column -->
            <ng-container matColumnDef="numberOfQuestions">
            <th mat-header-cell *matHeaderCellDef> Broj Pitanja </th>
            <td mat-cell *matCellDef="let element"> {{element.numberOfQuestions}} </td>
            </ng-container>

        


            <ng-container matColumnDef="expand">
                <th mat-header-cell *matHeaderCellDef aria-label="row actions">&nbsp;</th>
                <td mat-cell *matCellDef="let element">
                    <button mat-icon-button aria-label="expand row" (click)="(expandedElement = expandedElement === element ? null : element); $event.stopPropagation()">
                    <mat-icon *ngIf="expandedElement !== element">keyboard_arrow_down</mat-icon>
                    <mat-icon *ngIf="expandedElement === element">keyboard_arrow_up</mat-icon>
                    </button>
                </td>
            </ng-container>

            <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
        <ng-container matColumnDef="expandedDetail">
            <td mat-cell *matCellDef="let element" [attr.colspan]="columnsToDisplayWithExpand.length">
            <div class="example-element-detail"
                [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
                <div class="example-element-description">
                {{element.description}}
                </div>
            </div>
            </td>
        </ng-container>

        
            <tr mat-header-row *matHeaderRowDef="columnsToDisplayWithExpand"></tr>
            <tr mat-row *matRowDef="let element; columns: columnsToDisplayWithExpand;"
            
            >
            </tr>
            <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
        </table>

        <div style="text-align: center;">
            <button (click)="startQuiz()" 
                    type="submit"
                    mat-raised-button
                    [disabled]="!quizSetup.valid">Pokreni Kviz</button>
            <button mat-raised-button 
                    (click)="openQuizSettingsDialog()">Postavke</button>
        </div>                
            </ng-template>

            

            <div *ngIf="!isIdle(); then questionBlock"></div>

            <ng-template #questionBlock>
                <div style="text-align: left;">

                    <div class="questionTitleCard">
                        <div class="questionText">
                            <div class="questionNumber">
                                Set pitanja : {{quizHostService.quizData.currentQuestionSet.name}}
                                <br>
                                Pitanje {{quizHostService.quizData.currentQuestionIndex + 1}}
                                od {{quizHostService.quizData.questions.length}}
                            </div>
                            {{quizHostService.quizData.currentQuestion.text}}
                        </div>
                        <app-spinner [time]="currentSpinnerTimeout" [text]="currentSpinnerText"
                            (timeout)="spinnerTimeout()">
                        </app-spinner>
                    </div>
                    <div class="answer-cards">
                        <div *ngFor="let answer of quizHostService.quizData.currentQuestion.answers; let i = index"
                            style="width: 50%;">
                            <mat-card class="answer-card" [class.correct]="answer.isCorrect && isShowingAnswers()">
                                <span class="answer-letter">{{getLetter(i)}}:</span> {{answer.text}}
                            </mat-card>
                        </div>
                    </div>
                </div>
            </ng-template>

            <ng-template #scoreBoardBlock>
                <div style="text-align: center;">
                    <button mat-raised-button style="width: 80%;height: 100px;" (click)="startQuiz()">Pokreni novi
                        kviz</button>
                </div>
            </ng-template>

        </div>

    </div>

    <!-- <div class="log">
        Activity Log:
        <mat-divider></mat-divider>
        <div *ngFor="let message of quizHostService.signalRService.dataHistory">
            {{message}}
        </div>
    </div>

</div>


<div>
    ConnectionId: {{quizHostService.signalRService.connectionId}}
</div>

<mat-form-field>
    <input matInput name="question" [(ngModel)]="inputData" required>
</mat-form-field>
<button class="general-buttons" color="primary" mat-raised-button (click)="sendDataToGroup()">
    Send data to group
</button> -->